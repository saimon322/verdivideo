$(document).ready((function(){function checkContacts(){let validation=!0;return $(".basket-contacts input").each((function(){$(this).parents(".basket-contacts__payment.hidden").length||($(this).hasClass("empty")||$(this).hasClass("error")?validation=!1:$(this).val().length?contactsInputValidate($(this))?hideErrorMessage($(this)):($(this).addClass("error"),showErrorMessage($(this)),validation=!1):($(this).addClass("empty").val("Не заполнено"),$(this).siblings("label").addClass("active"),showErrorMessage($(this)),validation=!1))})),!!validation}function contactsInputValidate(input){if(input.is("#phone"))return input.val().length>=5;if(input.is("#index"))return 6==input.val().length;if(input.is("#email")){let mailformat=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return input.val().match(mailformat)}return!0}$(".header-basket").click((function(){$(".header-basket").addClass("active"),$(".basket, .overlay").addClass("show"),$("body").addClass("overflow")})),$(".overlay, .js-basket-close, .js-basket-refresh").click((function(){$(".header-basket").removeClass("active"),$(".basket, .overlay").removeClass("show"),setTimeout((function(){$("body").removeClass("overflow"),5==$(".basket-step.active").data("step")&&($(".basket-step").removeClass("prev active").addClass("next"),$(".basket-step").first().removeClass("next").addClass("active"),$(".basket-product").remove(),$(".basket-goto-checkout").hide(),$(".basket-empty-message").show())}),700)})),$(".js-basket-next").click((function(){let step=$(this).parents(".basket-step"),stepNum=step.data("step"),newStep=$(".basket-step[data-step="+(stepNum+1)+"]");if(newStep.length){if(2==stepNum&&!checkContacts())return;if(4==stepNum&&!checkPayment())return;newStep.addClass("active").removeClass("next").scrollTop(0),step.removeClass("active").addClass("prev")}})),$(".js-basket-prev").click((function(){let step=$(this).parents(".basket-step"),stepNum=step.data("step"),newStep=$(".basket-step[data-step="+(stepNum-1)+"]");newStep.length&&(newStep.addClass("active").removeClass("prev").scrollTop(0),step.removeClass("active").addClass("next"))})),$(".basket-counter__btn").click((function(){let counter=$(this).siblings(".basket-counter__count"),count=parseInt(counter.text());if($(this).hasClass("plus")?count++:$(this).hasClass("minus")&&count--,count>=0&&counter.text(count),0==count){let step;$(this).parents(".basket-product").slideUp(500,(function(){$(this).remove()})),1==$(".basket-step.active").find(".basket-product").length&&$(".basket-goto-checkout").fadeOut(500,(function(){$(".basket-empty-message").show()}))}})),$(".basket-contacts__tab").click((function(){if(!$(this).hasClass("active")){$(".basket-contacts__tab").toggleClass("active"),$(".basket-contacts__header").toggleClass("active"),$(".basket-contacts__payment").toggleClass("hidden"),$(".basket-error").removeClass("show").slideUp();let step=$(".basket-step.active");step.find(".basket__errors").removeClass("show"),step.find(".basket-message--ok").show(),step.find(".basket-message--error").hide(),$(".basket-contacts input").each((function(){$(this).hasClass("empty")&&$(this).val(""),$(this).removeClass("empty error")}))}})),$((function(){let phone=document.getElementById("phone"),index=document.getElementById("index"),phone_mask=new IMask(phone,{mask:"+{7} 000 000 00 00"}),index_mask=new IMask(index,{mask:"000000"})})),$(".basket-contacts input").focus((function(){$(this).hasClass("empty")&&$(this).val(""),$(this).removeClass("empty error")})),$((function(){let cardnumber=document.getElementById("cardnumber"),expirationmonth=document.getElementById("expirationmonth"),expirationyear=document.getElementById("expirationyear"),securitycode=document.getElementById("securitycode"),cardnumber_mask=new IMask(cardnumber,{mask:"0000 0000 0000 0000"}),expirationmonth_mask=new IMask(expirationmonth,{mask:"MM",groups:{MM:new IMask.MaskedPattern.Group.Range([1,12])}}),expirationyear_mask=new IMask(expirationyear,{mask:"YY",groups:{YY:new IMask.MaskedPattern.Group.Range([0,99])}}),securitycode_mask=new IMask(securitycode,{mask:"0000"})}));let cardnumber=$("#cardnumber"),visa=$("#visa"),mastercard=$("#mastercard"),dateYear=parseInt((new Date).getFullYear().toString().substr(-2)),dateMonth=(new Date).getMonth()+1;function checkPayment(){let validation=!0;return $(".basket-card input").each((function(){$(this).hasClass("empty")||$(this).hasClass("error")?validation=!1:$(this).val().length?cardInputValidate($(this))?hideErrorMessage($(this)):($(this).addClass("error"),showErrorMessage($(this)),validation=!1):($(this).addClass("empty"),showErrorMessage($(this)),validation=!1)})),!!validation}function cardInputValidate(input){if(input.is("#cardowner"))return input.val().length>=5;if(input.is("#cardnumber"))return $.payform.validateCardNumber(input.val());if(input.is("#securitycode"))return $.payform.validateCardCVC(input.val());if(input.is("#expirationyear")){let inputYear;return parseInt(input.val())>=dateYear}if(input.is("#expirationmonth")){let inputYear=parseInt($("#expirationyear").val()),inputMonth=parseInt(input.val());return!(inputYear==dateYear&&inputMonth<dateMonth)}}function showErrorMessage(input){let id=input.attr("id"),errorsCount;if($(".basket-error[data-error='"+id+"']").addClass("show").slideDown(),$(".basket-error.show").length>0){let step=input.parents(".basket-step");step.find(".basket__errors").addClass("show"),step.find(".basket-message--ok").hide(),step.find(".basket-message--error").show()}}function hideErrorMessage(input){let id=input.attr("id"),errorsCount;if($(".basket-error[data-error='"+id+"']").removeClass("show").slideUp(),0==$(".basket-error.show").length){let step=$(".basket-step.active");step.find(".basket__errors").removeClass("show"),step.find(".basket-message--ok").show(),step.find(".basket-message--error").hide()}}$(".basket-card input").keyup((function(){$(this).removeClass("empty error")})),cardnumber.keyup((function(){$(this).val().length?(visa.addClass("transparent"),mastercard.addClass("transparent"),"visa"==$.payform.parseCardType(cardnumber.val())?visa.removeClass("transparent"):"mastercard"==$.payform.parseCardType(cardnumber.val())&&mastercard.removeClass("transparent")):(visa.removeClass("transparent"),mastercard.removeClass("transparent"))}))}));